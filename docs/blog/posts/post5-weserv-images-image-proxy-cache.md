---
title: "weserv/images â€” ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ç”»åƒãƒ—ãƒ­ã‚­ã‚·ï¼†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹"
date: 2025-10-12
authors: [dsitweed]
categories:
  - ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
  - ã‚¤ãƒ³ãƒ•ãƒ©
tags:
  - weserv
  - ç”»åƒå‡¦ç†
  - ãƒ—ãƒ­ã‚­ã‚·
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - Docker
  - AWS
comments: true
---

## ğŸš€ weserv/images â€” ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ç”»åƒãƒ—ãƒ­ã‚­ã‚·ï¼†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹

**weserv/images** ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ **wsrv.nl** (æ—§ *images.weserv.nl*) ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã€è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ã§ **ç”»åƒå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹ (image proxy / image server)** ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚([weserv/images GitHub repo][1])

### ğŸ” å†…å®¹ï¼†ä¸»ãªæ©Ÿèƒ½

* ç”»åƒå‡¦ç†æ“ä½œã®ã‚µãƒãƒ¼ãƒˆ: resize, crop, format conversion, ç”»åƒæœ€é©åŒ–ã€‚
* **libvips** ãªã©ã®å¼·åŠ›ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€é«˜æ€§èƒ½ãªç”»åƒå‡¦ç†ã‚’å®Ÿç¾ã€‚
* **nginx** ã‚’ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã€HTTPã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦çµ„ã¿åˆã‚ã›ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã€‚
* Docker æ§‹æˆã®ã‚µãƒãƒ¼ãƒˆã§ã€è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒç°¡å˜ã€‚
* ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ **BSD-3-Clause License** ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ãŠã‚Šã€ä½¿ç”¨ã€ä¿®æ­£ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®çµ±åˆãŒå¯èƒ½ã€‚

### ğŸ›  ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼†åˆ©ç‚¹

* ã‚¦ã‚§ãƒ–ã¾ãŸã¯ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® **image proxy server** ã¨ã—ã¦ä½¿ç”¨: ã™ã¹ã¦ã®ç”»åƒãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµŒç”±ã—ã¦ resize / æœ€é©åŒ– / ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã€ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è² è·ã‚’è»½æ¸›ã€‚
* ç”»åƒå“è³ªã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ç‹¬è‡ªãƒ«ãƒ¼ãƒ« (ä¾‹: watermark, ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–) ã‚’åˆ¶å¾¡ã—ãŸã„å ´åˆã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ç‹¬è‡ªç”»åƒã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹å„ªã‚ŒãŸåŸºç›¤ã€‚
* é«˜æ€§èƒ½ (libvips + ã‚­ãƒ£ãƒƒã‚·ãƒ¥) ã§ã€å¤§è¦æ¨¡ç”»åƒå‡¦ç†ãŒå¯èƒ½ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ãŒå°‘ãªã„ã€‚
* å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç”»åƒã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ±åˆã—ãŸã„ãŒã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã«ä¾å­˜ã—ãŸããªã„å ´åˆã«é©ã—ã¦ã„ã‚‹ã€‚

---

## ğŸ”§ å…·ä½“çš„ãªå‹•ä½œ

URL ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«é€ä¿¡ã™ã‚‹ã¨:

```
https://images.weserv.nl/?url=https://example.com/image.jpg&w=400&h=300&fit=cover
```

ã‚·ã‚¹ãƒ†ãƒ ã¯:

1. ğŸ›° **Proxy request** â€“ `https://example.com/image.jpg` ã‹ã‚‰ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ğŸ§  **ç”»åƒå‡¦ç†** â€“ **libvips** ã‚’ä½¿ç”¨ã—ã¦ resize, crop, ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã€åœ§ç¸®ãªã©
3. ğŸ“¦ **çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥** â€“ å‡¦ç†æ¸ˆã¿ç”»åƒã‚’ (é€šå¸¸ nginx + ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯ CDN ã§) ä¿å­˜
4. âš¡ **æœ€é©åŒ–ç”»åƒã‚’è¿”å´** â€“ ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æœ€é©åŒ–ç”»åƒã‚’æä¾›

---

## ğŸ’¡ åˆ©ç‚¹

* **ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚µãƒ¼ãƒãƒ¼ã®è² è·è»½æ¸›** (ç”»åƒã¯ä¸€åº¦å‡¦ç†ã•ã‚Œã€æ¬¡å›ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰æä¾›)
* **ç”»åƒè¡¨ç¤ºé€Ÿåº¦ã®å‘ä¸Š** (è»½é‡ã§ãƒ‡ãƒã‚¤ã‚¹ã«é©ã—ãŸã‚µã‚¤ã‚º)
* **ç”»åƒã‚½ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ¬å½“ã® URL ã‚’çŸ¥ã‚‹å¿…è¦ãªã—)
* **æ‹¡å¼µæ€§** â€“ Docker ã§ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆå¯èƒ½

---

## ğŸ“¦ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä»•çµ„ã¿

### ğŸŸ¢ 1ï¸âƒ£ å…¬é–‹ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨æ™‚: [https://images.weserv.nl](https://images.weserv.nl)

* API å‘¼ã³å‡ºã—ä¾‹:

  ```
  https://images.weserv.nl/?url=https://example.com/image.jpg&w=400
  ```

  â†’ weserv.nl ã®ã‚µãƒ¼ãƒãƒ¼ãŒ:

  1. `example.com` ã‹ã‚‰ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  2. å‡¦ç† (resize, crop, åœ§ç¸®ãªã©)
  3. å†…éƒ¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (disk ã¾ãŸã¯ CDN) ã«ä¸€æ™‚ä¿å­˜

* **ç”»åƒã®ä¿å­˜æœŸé–“?**

  * ãƒªãƒã‚¸ãƒˆãƒªã¯æ­£ç¢ºãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã‚’å…¬é–‹ã—ã¦ã„ãªã„ãŒã€GitHub ã® issue ã¨ discussion ã«ã‚ˆã‚‹ã¨:

    * **ç”»åƒã¯ä¸€å®šæœŸé–“ (é€šå¸¸æ•°æ—¥ï½æ•°é€±é–“) ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã€ã‚µãƒ¼ãƒãƒ¼ã¨ CDN ã«ã‚ˆã‚‹ã€‚
    * ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯è‡ªå‹•çš„ã«æœŸé™åˆ‡ã‚Œã¾ãŸã¯å®¹é‡æº€äº†ã§å‰Šé™¤ã€‚
    * ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒãŒå¤‰æ›´ã•ã‚Œã¦ã‚‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã¾ã§å¤ã„ç”»åƒãŒæä¾›ã•ã‚Œã‚‹å¯èƒ½æ€§ã€‚

* ğŸš« ã¤ã¾ã‚Š:

  * weserv.nl ã‚’ **æ°¸ä¹…ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** ã¨è¦‹ãªã•ãªã„ã€‚
  * ã“ã‚Œã¯ **ä¸€æ™‚çš„ãª proxy + CDN ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã®ã¿ã€‚
  * ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã¯è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ (`example.com`) ã«å­˜åœ¨ã™ã‚‹å¿…è¦ã‚ã‚Š â€” ã‚ªãƒªã‚¸ãƒŠãƒ«ãŒå‰Šé™¤ã•ã‚Œã‚‹ã¨ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœŸé™å¾Œã«å†ä½œæˆä¸å¯ã€‚

### ğŸ”µ 2ï¸âƒ£ ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆæ™‚: weserv/images

* **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒªã‚·ãƒ¼ã‚’è‡ªåˆ†ã§å®šç¾©å¯èƒ½**:

  * **Redis**, **disk**, ã¾ãŸã¯ **CDN** (Cloudflare, Fastly ãªã©) ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  * TTL (time-to-live) ã‚’ä»»æ„ã«è¨­å®š: 1æ—¥ã€1é€±é–“ã€1ãƒ¶æœˆã€ç„¡æœŸé™ã€‚
* ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãªã®ã§:

  * ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‘ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
  * å‡¦ç†æ¸ˆã¿ç”»åƒã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¾ãŸã¯ S3 ã«ä¿å­˜
  * ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒå¤‰æ›´æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ç„¡åŠ¹åŒ–

---

## âš¡ ç°¡å˜ã¾ã¨ã‚

| ã‚±ãƒ¼ã‚¹                          | ç”»åƒä¿å­˜å ´æ‰€         | ä¿å­˜æœŸé–“                       | å‚™è€ƒ                          |
| ------------------------------- | -------------------- | ------------------------------ | ----------------------------- |
| `images.weserv.nl` (å…¬é–‹) ä½¿ç”¨ | weserv ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ | ä¸å®š (æ•°æ—¥ï½æ•°é€±é–“)            | æ°¸ä¹…ä¿å­˜ãªã—ã€proxy ã®ã¿      |
| weserv/images ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ     | è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯ CDN | è‡ªåˆ†ã§è¨­å®š                     | å¿…è¦ã«å¿œã˜ã¦é•·æœŸä¿å­˜å¯èƒ½      |

---

## ğŸ”„ ç”»åƒå¤‰æ›´æ™‚ã®å¯¾å¿œ

`images.weserv.nl` ã¯ **image proxy cache** ã¨ã—ã¦å‹•ä½œã™ã‚‹ãŸã‚:

* ã‚ªãƒªã‚¸ãƒŠãƒ« URL (ä¾‹: `https://images.weserv.nl/?url=example.com/image.jpg`) ã‚’é€ä¿¡ã™ã‚‹ã¨:

  1. `example.com` ã‹ã‚‰ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã‚’å–å¾—ã€‚
  2. ã‚·ã‚¹ãƒ†ãƒ ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚
  3. ä»¥å¾Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”»åƒã‚’è¿”å´ã€‚

âš ï¸ ã—ã‹ã—:

* Weserv ã¯ **ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã®å¤‰æ›´ã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã—ãªã„**ã€‚
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸç”»åƒã¯ **æœŸé™åˆ‡ã‚Œã¾ãŸã¯å‰Šé™¤ã•ã‚Œã‚‹ã¾ã§å¤ã„ã¾ã¾æä¾›**ã€‚

âœ… **è§£æ±ºç­–:**

* ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒãŒå¤‰æ›´ã•ã‚Œã€æ–°ã—ã„ç”»åƒãŒå¿…è¦ãªã‚‰ã€query string ã‚’å°‘ã—å¤‰æ›´ (ä¾‹: `?t=timestamp`ï¼ˆä¾‹ãˆã°ï¼šupdated_at timestampï¼‰ ã¾ãŸã¯ `?v=2`)ã€ä»¥ä¸‹ã®ã‚ˆã†ã«:

  ```
  https://images.weserv.nl/?url=example.com/image.jpg&t=1760281316
  ```

  => URL ãŒç•°ãªã‚‹ãŸã‚ã€weserv ã¯æ–°ã—ã„ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒã‚’å†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚

---

## ğŸ— ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã®ã‚¢ã‚¤ãƒ‡ã‚¢

å®Œå…¨ã«å®Ÿç¾å¯èƒ½ ğŸ’¡
[weserv/images](https://github.com/weserv/images) ã¯ **ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹** ãªã®ã§:

* ç‹¬è‡ªã‚¤ãƒ³ãƒ•ãƒ© (Docker, Kubernetes ãªã©) ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
* `images.weserv.nl` ã¨åŒæ§˜ã« **resize, crop, optimize, cache** ã«ä½¿ç”¨ã€‚

ğŸ‘‰ ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã®åˆ©ç‚¹:

* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ / invalidation ã®å®Œå…¨åˆ¶å¾¡ã€‚
* Rate limit ãªã—ã€‚
* ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ä¾å­˜ã®å‰Šæ¸›ã€‚
* èªè¨¼ã‚„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ CDN ã®è¿½åŠ çµ±åˆå¯èƒ½ã€‚

---

## âš–ï¸ AWS ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¯”è¼ƒ

| ã‚·ãƒŠãƒªã‚ª                                                                 | Weserv ã‚’ä½¿ç”¨ã™ã¹ãã‹?          | èª¬æ˜                                                                                                  |
| ------------------------------------------------------------------------ | ------------------------------- | ----------------------------------------------------------------------------------------------------- |
| **é™çš„ç”»åƒã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ + ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã®ã¿å¿…è¦                         | âŒ ä¸è¦                          | S3 + CloudFront ã§ååˆ†: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚°ãƒ­ãƒ¼ãƒãƒ« CDNã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚ã‚Šã€‚                              |
| **å‹•çš„ç”»åƒå¤‰æ›** (ä¾‹: thumbnail, webp, ã‚µã‚¤ã‚ºå‰Šæ¸›) ãŒå¿…è¦               | âœ… Weserv ã¾ãŸã¯ç‹¬è‡ªæ§‹ç¯‰         | Weserv/images ã«ç”»åƒå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ã‚Šã€‚AWS ã§ã¯ Lambda@Edge ã¾ãŸã¯ Image Handler ã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ã€‚ |
| AWS Lambda / CloudFront Functions ã‚ˆã‚Šä½ã‚³ã‚¹ãƒˆã§åˆ¶å¾¡ã—ãŸã„             | âœ… å¯èƒ½                          | Weserv ã¯ C/C++ (libvips) ã§å‹•ä½œã—ã€å¤§è¦æ¨¡ç”»åƒå‡¦ç†ã§ Lambda ã‚ˆã‚Šè»½é‡ãƒ»åŠ¹ç‡çš„ã€‚                        |

---

ğŸ‘‰ **ã¾ã¨ã‚:**

* `weserv/images` ã¯ **dynamic image transformation** (resize, crop, convert ãªã©) ãŒå¿…è¦ãªå ´åˆã«æœ‰ç”¨ã€‚
* é™çš„ç”»åƒã® CDN ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã¿ãªã‚‰ã€**S3 + CloudFront** ã§ååˆ†ã€é€Ÿãä¿¡é ¼æ€§ãŒé«˜ã„ã€‚

---

[1]: https://github.com/weserv/images "GitHub - weserv/images: Source code of wsrv.nl (formerly images.weserv.nl), to be used on your own server(s)."
